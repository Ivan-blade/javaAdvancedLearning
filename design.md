### 自定义mybatis设计思路

+ config包（编写配置操作相关的类）
  + XMLConfigBuilder
    + 作用：加载配置文件，获取数据库配置信息和调用XMLMapperBuilder解析映射配置文件中的sql相关信息
    + 流程：初始化Configuration对象，并使用dom4j解析存放数据库配置的xml文件，将相关配置封装到连接池中再转交给configuration，之后通过对xml中记录的mapper映射文件路径的扫描，分别加载字节流并通过XMLMapperBuilder将映射文件中的相关配置加载到configuration中
  + XMLMapperBuilder
    + 作用：解析映射文件
    + 流程：使用dom4j方式将单个映射配置文件中的namespace以及带有select,update,delete,insert四种标签中包含的id，parameterType和resultType以及sql语句分别保存到configuration中的mappedStatementMap中，其中key为namespace.id，value为mappedStatement对象，由id,resultType,parameterType以及sql组成
+ io（编写文件流相关的类）
  + Resources
    + 作用：将配置文件加载为字节输入流
+ pojo（编写公共java类）
  + Configuration
    + 作用：存储数据源信息和格式化为key，value形式的的映射文件信息
    + 字段：
      + dataSource
      + mappedStatementMap
  + MappedStatement
    + 作用：存放映射文件中单个标签中的信息
    + 字段：
      + id
      + resultType
      + parameterType
      + Sql
+ sqlSession（编写sqlSession相关的类）
  + BoundSql
    + 作用：存放格式化后符合jdbc语法的sql和sql中需要传入的参数数据
  + Executor
    + 调用jdbc功能的接口，query，update
  + SimpleExecutor
    + 执行器实现类
    + 将映射文件中的sql语句格式化为jdbc能够操作的语句并封装到BoundSql里
    + 通过jdbc的预处理语句平台实现接口中定义的方法
  + SqlSession
    + 功能：存放功能接口
    + 具体接口
      + selectList
        + 查询多个对象
      + selectOne
        + 查询单个对象
      + update
        + 修改对象
      + getMapper
        + 动态代理接口
  + DefaultSqlSession
    + sqlsession的实现类，实现sqlsession接口中定义的方法
    + selectList
      + 创建SimpleExecutor对象，调用query方法，返回结果集
    + selectOne
      + 直接调用selectList方法，如果数量为一返回，否则报错
    + update
      + 创建SimpleExecutor对象，调用update方法
    + getMapper
      + 使用jdk动态代理对象，根据传入参数判断需要执行的方法
      + 如果返回类型是Integer，都是调用update方法
      + 如果返回类型含有泛型，则是返回selectList
      + 否则，返回selectOne
  + SqlSessionFactory
    + 定义openSession方法用于返回sqlsession
  + DefaultSqlSessionFactory
    + 实现opensession方法返回sqlsession对象
  + SqlSessionFactoryBuilder
    + 解析输入流，通过xmlConfigBuilder返回configuration对象，并将该对象传入给DefaultSqlSessionFactory用于返回sqlsessionFactory
+ util（编写工具包类）
  + GenericTokenParser
    + 该方法主要实现了配置文件、脚本等片段中占位符的解析、处理工作，并返回最终需要的数据。
    + 扫描#{}标记调用TokenHandler接口对标记中的变量做处理
  + ParameterMapping
    + 记录内容
  + TokenHandler
    + 定义处理方法接口
  + ParameterMappingTokenHandler
    + 实现TokenHandler接口
    + 将#{}中的变量加入到ParameterMapping中，然后替换为?